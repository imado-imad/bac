<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Responsive PDF Viewer with Drag Before Zoom</title>
<style>
  html, body {
    margin: 0; padding: 0; height: 100%; overflow: hidden;
    background: #fff;
  }
  #pdf-container {
    width: 100vw;
    height: 100vh;
    overflow-y: scroll;
    -webkit-overflow-scrolling: touch;
    position: relative;
    touch-action: pan-y; /* Allow vertical scroll gestures */
    user-select: none;
  }
  canvas {
    display: block;
    width: 100%;
    height: auto; /* maintain aspect ratio */
    user-select: none;
    -webkit-user-drag: none;
    margin: 0 auto;
  }
</style>
</head>
<body>
<div id="pdf-container"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.9.179/pdf.min.js"></script>
<script src="https://unpkg.com/pinch-zoom-js@2.3.5/dist/pinch-zoom.umd.js"></script>
<script>
  const url = 'https://imado-imad.github.io/bac/pdfs/2024-mathematics-exam-1.pdf';
  const container = document.getElementById('pdf-container');
  let pdfDoc = null;

  // Initialize PDF.js worker
  pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.9.179/pdf.worker.min.js';

  async function renderPDF() {
    pdfDoc = await pdfjsLib.getDocument(url).promise;
    for(let pageNum = 1; pageNum <= pdfDoc.numPages; pageNum++) {
      const page = await pdfDoc.getPage(pageNum);
      const viewport = page.getViewport({ scale: 1 });
      const canvas = document.createElement('canvas');
      const context = canvas.getContext('2d');
      canvas.width = viewport.width;
      canvas.height = viewport.height;
      canvas.style.width = '100%';
      canvas.style.height = 'auto';
      container.appendChild(canvas);
      await page.render({canvasContext: context, viewport: viewport}).promise;
    }
  }

  renderPDF().then(() => {
    // Initialize PinchZoom on the container
    const pz = new PinchZoom.default(container, {
      tapZoomFactor: 2,
      zoomOutFactor: 1,
      animationDuration: 300,
      maxZoom: 4,
      minZoom: 1,
      draggableUnzoomed: false, // Allow drag even when not zoomed
      lockDragAxis: false,
      setOffsetsOnce: true,
      use2d: true
    });

    // Double-click zoom toggle at clicked coordinates
    container.addEventListener('dblclick', (event) => {
      event.preventDefault();
      const rect = container.getBoundingClientRect();
      const offsetX = event.clientX - rect.left;
      const offsetY = event.clientY - rect.top;
      if (pz.getScale() === 1) {
        pz.zoomTo(offsetX, offsetY, 2);
      } else {
        pz.zoomTo(offsetX, offsetY, 1);
      }
    });
  });
</script>
</body>
</html>
